---
title: <span style="color:orange">Human Resources - Who is leaving the company?</span>
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


by Lieby Cardoso
========================================================

This data set was simulated and made available by Ludovic Benistant to the Kaggle site. 
Source: [Kaggle - Ludovic Benistant - Hr Analytics](https://www.kaggle.com/ludobenistant/hr-analytics)

** Attributes: **

1. Satisfaction_level: Level of collaborator satisfaction
2. Last_evaluation: Rating from last rating
3. Number_project: Number of projects worked
4. Average_montly_hours: Monthly average hours worked
5. Time_spend_company: Years of work in the company
6. Work_accident: 0 - Did not have an accident at work and 1 - Had an accident at work
7. Left: Dismissal indicator, 0 - Contracted and 1 - Off
8. Promotion_last_5years: Promotion indicative, 0 - No and 1 - Yes
9. Sales: Department
10. Salary: Salary, Low, Medium and High

Objective The objective of this project is to explore the variables of the hr data set that can help in identifying the factors that led some collaborator to leave the company. During the investigation these questions will be answered:

Did the employees who left receive a low salary?
Is the employee's dissatisfaction perceptible?
Overworked, was it a negative factor?

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Carregue aqui todos os pacotes utilizados 
# na sua análise realizada neste arquivo fonte.

# Note que o parÃ¢metro "echo" foi definido como FALSE neste cÃ³digo.
# Isso previne que o cÃ³digo apresente resultados formatados em HTML.
# Você deve definir echo=FALSE para todos os blocos de cÃ³digo no seu arquivo.

library(ggplot2)

library(ggthemes) 

# Cria objetos gráficos e posiciona em uma página
library(gridExtra)

# Facilita a limpeza dos dados spread() & gather()
library(tidyr)

# Manipulação de dados
library(dplyr)

# Templates adicionais do ggplot2
library(GGally)
library(RColorBrewer)

library(plyr)
library(corrplot)
library(formattable)

library(memisc)
library(lattice)
library(MASS)
library(car)
library(reshape)
library(formattable)
library(rpart)
library(pROC)
library(rpart.plot)
```


```{r echo=FALSE, Load_the_Data}
# Carregamento dos dados

hr <- read.csv('HR_data.csv', 
               sep = ',', 
               na.strings=c("","NA"))
names(hr)

```

** Data overview **

Summary:
```{r echo=FALSE}
summary(hr)
```
The data is consistent and analyzing the minimum, mean, median and maximum value, it was not possible to verify in this initial analysis the existence of outliers.

We will check the structure of the data, and whether it will be necessary to manipulate the types of variables to aid analysis.
```{r}
str(hr)
```

The data set consists of 14,999 observations and 10 variables. It does not have any variable that is a unique identification of the collaborator, so let's consider that each record corresponds to one person, without duplication.

```{r}
hr$salary<-ordered(hr$salary,levels=c("low","medium","high"))
```

The level of collaborator satisfaction will be grouped into three levels: YES, NO and REGULAR.

```{r}
# Cria novo campo satisfied no conjunto de dados hr
hr$satisfied <- as.factor(ifelse(hr$satisfaction_level<=.40, "NO", 
                                 ifelse(hr$satisfaction_level<=.70, "REGULAR", 
                                        "YES")))
```

Checking the created fields: 
```{r}
table(hr$satisfied)
```

Are there any null values? Let's walk through all the variables by adding all null values. 

```{r}
# Verifica o total de NA em cada campo
colSums(is.na(hr))

```

The dataset is completely populated and you do not need to manipulate these values.

# Univariate Graphics Section

In this section, the variables were grouped into two groups, the first one is to explore the information that helps us to characterize the company and the second, the variables that help us understand the profile of employees hired and left the company. 

## How is the company?

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(as.factor(left)),  data = hr) + 
  geom_histogram(stat   = "count",
                 fill   = "#6699CC", 
                 colour = "#666666") +
  stat_count(aes(y     = ..count..,
                 label = ..count..),
                 geom  = "text", 
                 vjust = -0.5) +
  scale_x_discrete(labels = c("0" = "Contratado", 
                              "1" = "Desligado")) +
  labs(title = "Total de colaboradores Contratados x Desligados", 
       y     = "Total colaboradores", 
       x     = "Status da contratação")
```
  
People who leave ratio:

```{r}
prop.table(table(hr$left))
```

Left, a variable focus of the analysis, is divided between contractors, that is, who are still in the company and who leave. Of the total 14,999 employees, 3,571 were dismissed and 11,428 were active. A proportion of  collaborators who have left a company for 24% of the data set. 


```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(as.factor(time_spend_company)), data = hr) + 
  geom_histogram(stat   = "count", 
                 fill   = "#6699CC",  
                 colour = "#666666") +
   stat_count(aes(y     = ..count..,
                 label = ..count..),
                 geom  = "text", 
                 vjust = -0.5) +
  labs(title = "Total de colaboradores por ano trabalhado na empresa", 
       y     = "Total colaboradores", 
       x     = "Total de anos trabalhados")
```
  
This is a positively skewed distribution, with a reduction in the number of  collaborators per year as it approaches the right tail. Let's check this trend and confirm that the median value is less than the mean value through the statistical summary of the variable time_spend_company:

```{r}
summary(hr$time_spend_company)
```

The median is 3 years, corresponding to the year that in fact has the largest number of collaborators, being 6,443 people. The largest volume (75%) of employees in the dataset worked between 2 and 4 years, being the limit of the 3rd quartile in the 4th year.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(as.factor(Work_accident)),  data = hr) + 
  geom_histogram(stat   = "count",
                 fill   = "#6699CC", 
                 colour = "#666666") +
  stat_count(aes(y     = ..count..,
                 label = ..count..),
                 geom  = "text", 
                 vjust = -0.5) +
  scale_x_discrete(labels = c("0" = "NÂO", "1" = "SIM")) +
  labs(title = "Ocorreu acidente de trabalho?", 
       y     = "Total", 
       x     = "Acidente de trabalho")
```
  
This is an unexpected fact for me. Of the total of 14,999 collaborators registered in the data set, 2,169 suffered an accident at work, or 14% of the total. To compile a comparison, according to data from the Fundacentro - Ministry of Labor, in 2013, 717,911 injured people were registered in the pension plan, with a total of 96 million people employed. This gives us a percentage of 0.75%, well below the 14% recorded by our company.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(average_montly_hours),  data = hr) + 
  geom_histogram(aes(y = ..density..),
                 binwidth = 10,
                 fill   = "#6699CC", 
                 colour = "#666666") +
  scale_x_continuous(breaks = seq(95,330,20)) +
  labs(title = "Média mensal de horas trabalhadas", 
       y     = "Total", 
       x     = "Hora mensal trabalhada") +
  geom_density()

```
 
The monthly average hours worked has a bimodal distribution, with a peak between 140 and 155 hours and another between approximately 245 and 265 hours.

Statistical summary of the variable average_montly_hours:

```{r}
summary(hr$average_montly_hours)
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(sales),  data = hr) + 
  geom_histogram(stat   = "count",
                 fill   = "#6699CC", 
                 colour = "#666666") +
  stat_count(aes(y     = ..count..,
                 label = ..count..),
                 geom  = "text", 
                 vjust = -0.5) +
  labs(title = "Total de colaboradores por departamento", 
       y     = "Total", 
       x     = "Departamentos")
```

```{r}
# Agrupa o total de resultados por departamento
Funcionarios_departamento <- aggregate(hr$sales, by=list(hr$sales),
                                       FUN = length)

formattable(Funcionarios_departamento, 
            list(x = color_tile("white", "#6699CC")))
```
 

O departamento Sales é o com a maior quantidade de colaboradores, seguido pelo departamento Technical e Support, somando 9.089 colaboradores. O Management é o menor deles com 630 colaboradores. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
 ggplot(aes(as.factor(promotion_last_5years)),  data = hr) + 
  geom_bar(fill   = "#6699CC",  
           colour = "#666666") +
  stat_count(aes(y     = ..count..,
                 label = ..count..),
                 geom  = "text", 
                 vjust = -0.5) +
  scale_x_discrete(labels = c("0" = "NÂO", "1" = "SIM")) +
  labs(title = "Promoção nos ultimos 5 anos", 
       y     = "Total", 
       x     = "Promoções") 
```

Very few people promoted. Only 2% of people have already been promoted. Knowing the career plan policy would be important to understand this shortage of promotions.

### Employee profile

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(as.factor(number_project)),  data = hr) + 
  geom_histogram(stat   = "count",
                 fill   = "#6699CC", 
                 colour = "#666666") +
  stat_count(aes(y     = ..count..,
                 label = ..count..),
                 geom  = "text", 
                 vjust = -0.5) +
  labs(title = "Total de projetos trabalhados", 
       y     = "Total", 
       x     = "Número de projetos trabalhados")
```
  
There is no record of anyone working on a single project. The employees worked on at least 2 and at most 7 projects.

```{r}
summary(hr$number_project)
```

On average people worked on 4 projects.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(last_evaluation),  data = hr) + 
  geom_histogram(binwidth = 0.05,  
                 fill     = "#6699CC",  
                 colour   = "#666666") +
  scale_x_continuous(breaks = seq(0.3,1.0,0.1)) +
  labs(title = "Nota recebida na última Avaliação", 
       y     = "Total de colaboradores", 
       x     = "Nota da Avaliação")

```
  
```{r}
sum(hr$last_evaluation >= 0.7)
```

The company is made up of a majority of  employees with medium to high valuation. For this analysis we will consider that a grade equal to or greater than 7 is considered high. Thus, we have 8,015 employees well evaluated by the company, this corresponds to 53% of the people. 


```{r echo=FALSE, message=FALSE, warning=FALSE}

# grafico1: Nível de satisfação
ggplot(aes(satisfaction_level),  data = hr) + 
  geom_bar(binwidth = 0.1,  
           fill     = "#6699CC",  
           colour   = "#666666") +
  scale_x_continuous(breaks = seq(0.1,1.0,0.1)) +
  #facet_wrap( ~ left) +
  labs(title = "Nível de satisfação dos colaboradores", 
       y     = "Total de colaboradores", 
       x     = "Nível de satisfação")

```

```{r}
sum(hr$satisfaction_level <= 0.3)
sum(hr$satisfaction_level >= 0.7)
```

It is possible to observe that there are employees with a low level of satisfaction (<0.3). From the total, 1,941 people had a satisfaction level of less than 0.3. At the other end of the distribution, we have 6,502 employees with a satisfaction level equal to or above 0.7.
  
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(satisfied),  data = hr) + 
  geom_histogram(stat     = "count", 
                 binwidth = 0.05,  
                 fill     = "#6699CC",  
                 colour   = "#666666") +
  stat_count(aes(y     = ..count..,
                 label = ..count..),
                 geom  = "text", 
                 vjust = -0.5) +
  facet_wrap( ~ left) +
  labs(title = "Total por faixa de satisfação  - (0=Contratado, 1=Desligado)", 
       y     = "Total de colaboradores", 
       x     = "Faixa de satisfação")
```

The satisfaction bandwidth was created to provide one more element of comparison between the contracted and disconnected. For the purpose of this analysis, consider that the ranges: 

No = Satisfaction level equal to or less than 0.4 
Regular = Satisfaction level between 0.4 and 0.7 
Yes = Satisfaction level greater than or equal to 0.7

```{r}
# Calcula a proporção de registros for faixa de satisfação agrupado pelo status da contratação
prop.table(table(subset(hr, select=c(satisfied, left))),2)
```
  
When we compare the proportions between the hired and those who leave, we notice that for the hired the satisfaction ranges that prevail are those of satisfaction and regular satisfaction, the two corresponding to 87% of the hired. For those who leave the dissatisfied range alone corresponds to 49% of this set. It is quite significant to think that half of who leaves were not satisfied. 

Among the hired we observe that the satisfied ones form the largest group, followed by those of regular satisfaction, dissatisfied individuals are the minority. 

# Univariate Analysis 

### What is the structure of the dataset? 

The data structure consists of 14,999 observations, 10 variables imported with the original file. The satisfied variable was added to represent in 3 bands (YES, REGULAR, NO) the satisfaction of the collaborator.

 The variable left represents the contraction status, with the domain: 0 = People who are still hired 1 = People who have been disconnected from the company.

In the data set we have 8 numerical variables and 2 categorical variables. The categorical variable sales has 10 levels and salary has 3. 

### What are the main attributes of interest in this data set?

The main variable of interest in the set is left, which tells you if the employee stay in the company or has left. The variable with the satisfaction level (satisfaction_level) will also be the focus of the analysis, since the correlation of the other variables with it can help to understand the reasons that led people to leave the company.

What other attributes do you think can help you in researching these attributes of interest?

1. Promotion_last_5years: The total of promotions received can generate a dissatisfaction in the collaborator if he supposes that it was not recognized;

2. Time_spend_company: The time spent in a company can generate a need to leave the company, not always for a negative cause, sometimes motivated by the will to live new challenges;

3. Salary: This variable is categorical with the low, medium, and high values. The relationship between pay and satisfaction and exit decision will be evaluated, although several surveys indicate that pay is not always a major influence on this decision. It is possible that variables like number of promotions and note received in the last evaluation weigh more on the sensation of having the work recognized and this is an important factor;

4. Number_project: This variable brings the total number of projects worked by the person, we do not know if it is the total in a certain period or during the whole stay in the company, but even though we can explore issues such as: people with more project numbers were more satisfied Or felt overwhelmed and left the company?

5. Sales: Is there a problem department with a low level of satisfaction? I believe that this issue is important to be investigated and can be impacting at the final of the result.

### Have you created new variables from the existing attributes in the data set?

The data set was very consistent, and only one change was made.

The satisfied variable, of factor type with 3 levels:YES, NO and REGULAR was created. The goal of this field is to facilitate the visualization of employees satisfaction ranges. The ranges defined for this project without any commitment to the standard values of a human resources department.

### Of the attributes investigated, were unusual distributions found? Have you applied operations on the data to clean them, set them or change the shape of the data? If yes, why?

I searched for NA variables, but the group had none. Variables without content were not searched because in the file import I assigned by default the NA value to them (na.strings = c ("", "NA"))  so, automatically when searching for NA, I was already searching for the empty .

In some graphs, I have turned the left variable into factor to help group the data into 0 and 1, not the average of these two numbers.

Looking at the summary of the variables, the data is consistent and without outliers, so it was not necessary to manipulate the content.

I reordered the salary content so that when printing the graphics I was able to demonstrate the data sequentially (Low => Medium => High).

The variable salary, which content is the salary range (high, medium, low), would be a great candidate to have the log10 operation applied to its content if it were the monetary value of the salary.

# Section of Bivariate Graphs

Now that we know a little about the variables of the data set, we will check how they relate to each other. In this section we will try to answer the questions described at the beginning of the project.

### <span style="color:orange">Did those who left receive a low salary? </span>

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots}
#desligados <- hr%>%
#             filter(left == 1)

ggplot(aes(x = sales, fill = salary), data = hr) + 
  geom_histogram(stat = 'count') +
  stat_count(aes(y      = ..count..,
                 label  = ..count..),
                 geom   = "text",
                 colour = "white",
                 size   = 2.5,
                 vjust  = 1) +
  scale_fill_wsj() +
  facet_wrap(~ left, scales = "free") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_color_wsj() +
  labs(title = "Faixa salarial por departamento agrupado por contratados e desligados",
       y     = "Total de colaboradores", 
       x     = "Departamentos")

```
  
When we put into perspective the salary bands by department grouped by the status of the hiring, it is possible to visualize the difference in the distribution of the salary bands among the hired and dismissed. For the unemployed we noticed few occurrences of high salaries, most of these occurrences being in the Technical and Sales departments. In the Management department there were no registered employees with high salaries among the dismissed, but among those hired this is the department where most employees receive a high salary. This pattern is not repeated in other departments.

Investigating the department a bit more, we will look at the proportion of people who left each department.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Cria um subgrupo de dados com a proporção dos colaboradores que deixaram cada departamento.
prop_left_sales <- data.frame(round(prop.table(table(hr$sales,hr$left), 1)*100,0))

# Altera o nome das colunas
colnames(prop_left_sales) <- c("Departamento", "left", "Frequencia")

# Transforma o conteúdo da variável left em coluna, e demonstra o valor de Freq para cada uma delas.
formattable(cast(prop_left_sales, Departamento ~ left, value="Frequencia"), 
            list("1" = color_tile("white", "#6699CC")))

```
  
The departments of management and research and development (RandD) had the least evasion of employees. The other departments 22 to 29% of their employees left the company. Below we can see this distribution:

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(prop_left_sales, aes(x     = Departamento, 
                            y     = Frequencia, 
                            fill  = left, 
                            label = sprintf("%1.0f%%", Frequencia)))+
  geom_col() +
  geom_text() +
  scale_fill_wsj(name    = "left",
                 breaks  = c("0", "1"),
                 labels  = c("Contratado", "Desligado" )) +
  theme(axis.text.x = element_text(angle=90, hjust=1)) +
  labs(title = "Percentual de demitidos",
       y     = "Frequência", 
       x     = "Departamentos")
  
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(hr, aes(x    =  sales, 
               y    = average_montly_hours, 
               fill = as.factor(left))) + 
  geom_boxplot(outlier.colour = "black") + 
  labs(title = "Horas trabalhadas por departamento",
       x     = "Departamento",
       y     = "Média mensal de horas trabalhadas") +
  theme(axis.text.x = element_text(angle=90, hjust=1)) +
  scale_fill_wsj(name   = "left",
                 breaks = c("0", "1"),
                 labels = c("Contratado", "Desligado" ))
```
  
We found a very similar distribution of data among the hired, they worked from 150 to 250 hours in the month. For who leave, what we observe is a distribution with a minima of less than 150 and maximums above 250 monthly hours. In the previous graphs we saw that they tend to earn less, but only with that information did I imagine that they could work less, but now, we find that contrary to what I thought, they worked for longer hours, especially in the RandD department where a higher average was recorded. In the marketing and HR department, people worked between 150 and 250 hours, but with a lower median.

I will create a new dataset with the average hours worked by each department grouped by left, so we can confirm these findings:

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Cria dataset com a media de horas trabalhadas por departamento
media_hora_departamento <- aggregate(hr$average_montly_hours, 
                                     by  = list(hr$sales, hr$left ) ,
                                     FUN = mean)

# Renomeia as colunas
colnames(media_hora_departamento) <- c("Departamento", "left", "Media")

# Transforma o conteúdo da variável left em coluna e preenche com os valores de média
media_hora_departamento <- cast(media_hora_departamento, Departamento ~ left, 
                                value = "Media")

# Renomeia as colunas
colnames(media_hora_departamento) <- c("Departamento", 
                                       "Contratado", 
                                       "Desligado")

# Imprime valores
formattable(media_hora_departamento, 
            list(Desligado = color_tile("gray", "red")))
                                    
```

With the exception of the human resources department (hr), the collaborators who left the company worked on average more than the other departments, reaching a monthly average of over 200 hours. The cases where the disconnected group worked for more hours were highlighted in red.

Summary statistics: average_montly_hours x left:
  
```{r echo=FALSE, message=FALSE, warning=FALSE}
table(hr$left)
by(hr$average_montly_hours, hr$left, summary)
```

We know that the employee who left work for longer hours and lower salaries, did they manage to stay in the company for many years?

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(hr, aes(x    =  as.factor(time_spend_company), 
               y    = average_montly_hours, 
               fill = as.factor(left))) + 
  geom_boxplot(outlier.colour = "black", outlier.size = 0.5) + 
  labs(title = "Horas mensais trabalhadas por anos de trabalho",
       x     = "Anos de trabalho",
       y     = "Horas mensais trabalhadas") +
  scale_fill_wsj(name   = "left",
                 breaks = c("0", "1"),
                 labels = c("Contratado", "Desligado" ))

``` 
  
Once again we have a different distribution for hired and who leave. In the set of data we have people who have worked in the company between 2 and 10 years. For those who worked for a total of 2 years, we noticed the smallest difference between the hired and who leaves, but as already noticed, even in this group, who leaves tended to work for more hours. The data for those who worked for 3 years is quite different from the others, they exhibit a new grouping of people who leaves and worked less hours than the average monthly. During the univariate graphs section, when we printed the distribution of the total number of people per years worked, we observed a peak in the 3rd year and from there a fall in the total of people per year after the 4th year.

```{r}
summary(hr$average_montly_hours)
```

Average hours worked in the month for the total number of years worked:

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Cria dataset com a media de horas trabalhadas por departamento
horas_trabalhadas_ano <- aggregate(hr$average_montly_hours, 
                                     by  = list(hr$time_spend_company, hr$left ) ,
                                     FUN = mean)

# Renomeia as colunas
colnames(horas_trabalhadas_ano) <- c("Anos_trabalhados", "left", "Media")

# Transforma o conteúdo da variável left em coluna e preenche com os valores de média
horas_trabalhadas_ano <- cast(horas_trabalhadas_ano, Anos_trabalhados ~ left, 
                                value = "Media")

# Renomeia as colunas
colnames(horas_trabalhadas_ano) <- c("Anos trabalhados", 
                                       "Contratado", 
                                       "Desligado")

# Imprime valores
formattable(horas_trabalhadas_ano, 
            list(Desligado = color_tile("white", "red")))
                                    
```

We have no records of people who left and who have worked for 7 years or more.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(hr, aes(x      =  as.factor(time_spend_company), 
               y      = satisfaction_level, 
               colour = as.factor(left))) + 
  geom_point(alpha = 1/5, 
             position = position_jitter(h=0)) + 
  labs(title = "Nível de satisfação por total de anos trabalhados",
       x     = "Total anos trabalhados",
       y     = "Nível de Satisfação") +
  scale_color_wsj(name   = "left",
                  breaks = c("0", "1"),
                  labels = c("Contratado", "Desligado" ))

``` 
  
We see dissatisfaction with employees who leave the company in the 3rd or 4th year. People who left the company in the 5th grade, mostly showed low or high satisfaction. Most of then who worked at the company for 6 years demonstrated a high satisfaction level of over 0.75. The ideal for this case is that we had a history of the levels of satisfaction of these people, year after year, so we could project from which year the dissatisfaction tends to increase or decrease.

Is there a similar variation in the evaluation grade received by this employee during the years worked? To find out this, we will see the evaluation grade per year worked:

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(hr, aes(x      =  as.factor(time_spend_company), 
               y      = last_evaluation, 
               colour = as.factor(left))) + 
  geom_point(alpha = 1/5, 
             position = position_jitter(h=0)) + 
  labs(title = "Nota na última avaliação por total de anos trabalhados",
       x     = "Anos de trabalho",
       y     = "Nota na avaliação") +
  scale_color_wsj(name   = "left",
                  breaks = c("0", "1"),
                  labels = c("Contratado", "Desligado" ))

``` 
  
Again the 3rd year appears as a divisor. The people who left the company in the 3rd year received a low score in the last evaluation, a fact that does not repeat from the 4th to the 6th year, where the majority of those employees received grades higher than 0.8.

Let's ask another question: Who has more projects works more?

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(hr, aes(x = average_montly_hours , fill=as.factor(number_project))) + 
  geom_bar(binwidth = 25,  
           colour   = "#666666") +
  scale_x_continuous(breaks = seq(80,325,20)) +
  labs(title = "Horas trabalhadas por total de projetos",
       x     = "Total Horas trabalhadas",
       y     = "Total") +
  scale_fill_wsj(name = "Total de projetos") 

``` 
  
We have no information on the level of complexity of the projects, or on the percentage of participation of each person in them. This distribution caused me some surprise and knowing a little more about the project would help us understand the following points:

1. In the lowest average monthly hours worked, there is a group of people who worked on 6 projects, in a maximum of 7 projects reported.
2. Between 100 and 200 hours, which is the average of this variable, is also registered a group that worked on more than 4 projects.
3. People with 7 projects worked above the average of 200 hours, recording an average above 240 hours monthly.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = sales, fill = as.factor(number_project)), data = hr) + 
  geom_histogram(stat = 'count') +
  stat_count(aes(y      = ..count..,
                 label  = ..count..),
                 geom   = "text",
                 colour = "black",
                 size   = 2.5,
                 vjust  = 1.5) +
  #facet_wrap(~ left, scales = "free") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_fill_wsj(name    = "Total de projetos") +
  labs(title = "Total de projetos por departamento",
       y     = "Total de colaboradores", 
       x     = "Departamentos")

``` 
 
I figured I could map some department that was overloading the developer with many projects, but all departments have people who have worked on 4 projects or more. Different from my expectation, in all departments were registered people with 7 projects.

Who worked on more projects received more?

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = salary, fill = as.factor(number_project)), data = hr) + 
  geom_histogram(stat = 'count') +
  stat_count(aes(y      = ..count..,
                 label  = ..count..),
                 geom   = "text",
                 colour = "black",
                 size   = 2.5,
                 vjust  = 1.5) +
  scale_fill_wsj(name    = "Total de projetos") +
  labs(title = "Total de projetos por faixa salarial",
       y     = "Total de colaboradores", 
       x     = "Faixa salarial")

``` 
  
Both people with high, medium or low salary worked on 2 projects or more. 144 people worked on 7 projects and received a low salary. So answering the question, I saw no evidence that the larger the number of projects, the better the salary range.

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(aes(x = as.factor(left) , 
           fill = as.factor(Work_accident)),
       data = hr) +
  geom_bar() +
  labs(title = "Ocorreu acidente de trabalho?",
       x     = "Status da contratação",
       y     = "Total") +
  scale_x_discrete(labels = c("0" = "Contratado", "1" = "Demitido")) +
  scale_fill_wsj(name = "Acidente?",
                 breaks = c("0", "1"),
                 labels = c("Não", "SIM" ))
``` 
  
Even though they have suffered an accident at work, the employees remain in the company. This variable does not seem to be related to the employee's exit.

Now that we know the importance of the variables satisfaction_level and average_montly_hours we will calculate the value of the pearson correlation for the data set variables hr:

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Imprime gráfico com a correção das variáveis númericas
corrplot(cor(subset(hr, select= -c(sales, salary, satisfied))), method="circle")
```
  
The larger and darker, the more correlated are the variables, the oranges have negative correlation values and the positive blue ones.
Let's confirm by calculating the values found:

```{r echo=FALSE}
# Valores da correlação entre as variáveis
cor(subset(hr, select = -c(sales, salary, satisfied)))

```

For the left variable the correlations were found:

1. Satisfaction_level = This was expected, with a value of -0.39 that is variable with the strongest correlation with left
2. Work_accident = Poor correlation, value -0.15
3. Time_spend_company = Poor correlation, value 0.14
4. Average_montly_hours = Very poor correlation, value 0.07
5. Promotion_last_5years = Very weak correlation, value -0.0


A little more graphical visualization between the main variables.

```{r echo=FALSE}
# Gera correlação e gráficos entre as variáveis numericas selecionadas
hr_ggpairs = subset(hr, select = -c(satisfied, sales, salary, Work_accident, promotion_last_5years))

g <- ggpairs(hr_ggpairs , upper = list(continuous = wrap("cor", size = 5, alignPercent = 1)),
                          lower = list(wrap = list(size = 5))) +
       theme(axis.text.x = element_text(angle = 45, vjust = 1, color = "black"))
```

```{r  eval=FALSE, echo=FALSE}
# Imprime a matriz com todos os gráficos em um arquivo svg. Retire o eval=FALSE para executar esta célula.
jpeg(filename = "gg.jpg")
print(g)
dev.off()
```

![ggpairs hr](gg.jpg)

  
# Bivariate Analysis
### Discuss some of the relationships observed in this part of the research. How did the attributes of interest vary in the data set?

Among those who left we found two distinct groups, those who worked longer than the average and, surprisingly, those who worked for fewer hours per month.

We have records of people who worked between 2 and 10 years in the company, but left completed a maximum of 6 years of work in the company. Among who stay it is possible to perceive a good level of satisfaction for those who are in the company for more than 7 years.

Among those who left, we found the lowest levels of dissatisfaction for employees who worked for 4 or 5 years in the company.

Most of those who had an accident at work during their journey remained in the company, there is a very weak correlation between these variables of -0.1546.

In all departments we had people who worked 7 projects, which was the maximum registered. People who worked on 7 projects, worked for more hours in the month, when purchased with an average of 201 hours per month. Number_project and average_montly_hours has the strongest correlation value of the group being r² = 0.4172.

When analyzing the salary range by department, we observed that for who left we found more people who received low or medium salaries. The range of high wages is less in all departments. No shutdowns were reported in the Management department of people with high salaries.

### Have you noticed any interesting relationships between the other attributes (those that are not of interest)?

The strongest relationship was found between the number of projects and average hours worked. It is not clear if the total of projects worked corresponds to a period, for example, are the projects worked in the month, in the year, since hiring? Assuming it's monthly, it would make sense to say that whoever did most projects, consequently may have had to work more hours in the month. Knowing the level of complexity of the project would help us in interpreting the relation of the number of projects and the time required to execute it.

### What was the strongest relationship found?

In what concerns this analysis, which is to investigate why some employees left the company, the variable level of satisfaction is the one that has the strongest correlation with left, indicator of shutdown. The correlation value was -0.388375, that is, 40% of the disconnections could be explained by the level of satisfaction, but that does not mean that it is the cause of it. 

# Multivariate Graphics Section

```{r echo=FALSE, Plot_Two}

ggplot(hr, aes(x     = sales, 
               y     = average_montly_hours, 
               color = salary)) + 
  geom_point(alpha    = 0.5,
             position = position_jitter(h=0))  +
  facet_wrap(~ left) +
  theme(axis.text.x = element_text(angle=90, hjust=1)) +
  scale_color_wsj()+
  labs(title = "Faixa salarial por total horas trabalhadas por departamento", 
       y     = "Média mensal de horas trabalhadas", 
       x     = "Departamento")
```
    
Once again we were able to visualize a different data distribution for those who left the company. They are polarized into two well-defined groups, sometimes working above or below the average. In the Sales and Support departments there is a higher incidence of the average salary range, but in the left group it is not possible to observe the prevalence of this range, most of them received a low salary, even in cases where they worked for more hours.

In the Management department, the affiliates also received low or medium salaries.

In this analysis we are assuming that people have the same position within the department, so that the comparison of the salary range is not meaningless.

We could not visualize a relationship between working longer hours and getting more for it, but who was involved in more projects received more?

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(hr, aes(x   = number_project, 
               y   = last_evaluation, 
               col = salary)) +  	
geom_point(alpha    = 0.2,
           position = position_jitter(h=0)) +
  facet_grid(salary ~ left) +
  scale_x_continuous(limits = c(1, 7), 
                     breaks = seq(1,7,1)) +
  labs(title = "Faixa salarial por Nota na última avaliação e Total de projetos",
       y = "Nota na avaliação", 
       x = "Número de projetos") +
  scale_color_wsj()
```
  
This chart brings new and relevant information, only who left worked on 7 projects, one more evidence of who left was overwhelmed. Those who left the company involved in 2 projects, regardless of the salary range, predominantly received low scores in their evaluations. People with more than 4 projects tended to receive better grades in their assessments.

If we put employee satisfaction in focus, do we see a graph similar to the one above?

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(hr, aes(x   = number_project, 
               y   = satisfaction_level, 
               col = salary)) +  	
geom_point(alpha = 0.2,
           position = position_jitter(h=0)) +
  facet_grid(salary ~ left) +
  scale_x_continuous(limits = c(1, 7), 
                     breaks = seq(1,7,1)) +
  labs(title = "Faixa salarial por Nível de satisfação e Total de projetos",
       y = "Nível de satisfação", 
       x = "Número de projetos") +
  scale_color_wsj()
```
  
We have people who left with the most diverse levels of satisfaction, the proportion of people by satisfaction range and numbers of projects can help us to understand these values.

```{r echo=FALSE}
prop.table(table(subset(hr, hr$left==1, select=c(number_project, satisfied))),1)
```

In this table we have the proportion of the satisfaction of who left by numbers of projects. We see the polarization again, people with 2 projects showed a low to regular satisfaction. The same goes for the group with 6 or 7 projects. Employees who worked on 4 or 5 projects had a predominantly high satisfaction.

We will see below if any one department has employees with more work load than others.  

```{r echo=FALSE}
ggplot(aes(x = as.factor(number_project) , 
           y = average_montly_hours,
           colour = average_montly_hours), 
       data = hr) + 
  geom_point(alpha = 1/15, 
             position = position_jitter(h=0)) +
  facet_wrap( ~ sales, ncol = 5) +
  labs(title = "Número de projetos e horas trabalhadas por departamento",
       y     = "Media hora mensal", 
       x     = "Total de projetos") 
```
  
From the 6th project there is an increase in the average monthly hours worked in all departments. Already people with 2 projects worked for less hours also in all departments.

### Why are the good and the satisfied leaving us?

To answer this question, the first step is to create a dataset with employee data that meet the criteria:

1. In the last evaluation they had a score higher than 0.7;
2. Worked in the company for more than 4 years;
3. Worked on more than 5 projects;
4. In the month, on average, they worked more than 200 hours.

```{r echo=FALSE}
hr_func_bons <- subset(hr, last_evaluation >= 0.70 & 
                           time_spend_company >= 4 & 
                           number_project > 5 & 
                           average_montly_hours > 200)
nrow(hr_func_bons)
```
  
The hr_func_bons data.frame was created with 961 records.

```{r echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Plots}
ggplot(hr_func_bons, aes(x    =  salary, 
                         y    = average_montly_hours, 
                         fill = as.factor(left))) + 
  geom_boxplot(outlier.colour = "black", outlier.size = 0.5) + 
  labs(title = "Faixa salarial por hora mensal trabalhada dos bons colaboradores",
       x = "Faixa salarial",
       y = "Horas mensais trabalhadas") +
  scale_fill_wsj(name    = "left",
                 breaks  = c("0", "1"),
                 labels  = c("Contratado", "Desligado" ))

```
  
It is not surprising that some people have decided to leave the company, they have worked more for the same salary range. Of course, for a more effective analysis of these variables, it would be necessary to know, for example, in the high wage range if the values are the same, or if those who worked the most received a larger amount, even though it was characterized as the same range.

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(hr_func_bons, aes(x    = sales , 
                         y    = average_montly_hours, 
                         fill = salary)) + 
  geom_boxplot(outlier.colour = "black", outlier.size = 0.5) + 
  theme(axis.text.x = element_text(angle=90, hjust=1)) +
  facet_wrap(~ left)+
  labs(title = "Faixa salarial e hora trabalhada por departamento dos bons colaboradores",
       x = "Departamento",
       y = "Horas mensais trabalhadas") +
  scale_fill_wsj()

```
  
This is the same information as the previous chart but now divided by department. The "good" employees only received high salaries in the sales and product_mg departments, but as we already know, they received the same range only for more hours of work.

### <span style="color:orange">Is the employee's dissatisfaction perceptible?</span>

What I want to know is if it is the employee's perception of himself, that is, his level of satisfaction relates in some way to the way the employer perceives the employee and assigns a score to him through the evaluation.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(hr, aes(x      = satisfaction_level , 
               y      = last_evaluation, 
               colour = satisfied)) + 
  geom_point(alpha = 1/3, 
             position = position_jitter(h=0)) + 
  geom_smooth(method ='lm', 
              size   = 1, 
              fill   = "black" ) +
  facet_wrap(~ left) +
  labs(title = "Relação do nível de satisfação com a nota na última avaliação",
       x = "Nível de Satisfação",
       y = "Nota na avaliação") +
  scale_color_wsj()
  
``` 
  
Among those who left the company, we have three very distinct groups:

1. Unsatisfied, but recognized as good by the company; In this group we have a clearly negative association between these two variables.
2. Unsatisfied and unrecognized, that is, they scored low on the evaluation;
3. Satisfied and recognized as good employee.

Receiving a bad grade in the assessment is not a common attribute among those who left.

### <span style="color:orange">Overworked, was it a negative factor?</span>

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = satisfaction_level, 
           y = average_montly_hours),  
       data = subset(hr, left==1)) +
  geom_point(aes(color = satisfaction_level)) +
  geom_smooth(method ='lm') +
  labs(title = "Nível de satisfação e média de horas trabalhadas dos desligados",
       x     = "Nível de Satisfação",
       y     = "Media mensal de horas trabalhadas") 
```
  
It is most interesting that among those who left the division of the unsatisfied is very clear. In this view, it is evident, but without explaining the cause, the imbalance in the hour worked. Responding to the initial question, the unsatisfied lived two situations, which worked more than the average and worked well less than the monthly average for this variable that are 200 hours a month. As the hours worked approached this range of 200 to 250, satisfaction increased.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = satisfaction_level, 
           y = average_montly_hours),  
       data = hr_func_bons) +
  geom_point(aes(color = as.factor(left))) +
  geom_smooth(method ='lm') +
  scale_color_wsj(name   = "left",
                  breaks = c("0", "1"),
                  labels = c("Contratado", "Desligado" )) +
  labs(title = "Nível de satisfação e média de horas trabalhadas dos bons colaboradores",
       x     = "Nível de Satisfação",
       y     = "Media mensal de horas trabalhadas")
```
  
The same chart printed for the data set of the "good employees" shows that who left worked on average for more hours compared to those who still work in the company, for which the points in the graph are more dispersed.

Let's print this same chart for the employees who recorded a lower income. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Cria dataset com as informações dos colaboradores medianos
hr_func_medianos <- subset(hr, last_evaluation < 0.70 & 
                               time_spend_company < 4 & 
                               number_project < 5 &
                               average_montly_hours < 200)

ggplot(aes(x = satisfaction_level, 
           y = average_montly_hours),  
       data = hr_func_medianos) +
  geom_point(aes(color = as.factor(left))) +
  geom_smooth(method ='lm') +
  scale_color_wsj(name   = "left",
                  breaks = c("0", "1"),
                  labels = c("Contratado", "Desligado" )) +
  labs(title = "Nível de satisfação e média de horas trabalhadas dos medianos",
       x     = "Nível de Satisfação",
       y     = "Media mensal de horas trabalhadas")
```
  
In this group we see that those who remained in the company had a positive trend in satisfaction, remaining between 0.5 and 1. Who leaves were more dissatisfied, perhaps because they did not reach their maximum potential or were not involved in many projects. As we are talking about human behavior, it is difficult to infer about real motivation without knowing more variables.

```{r echo=FALSE, message=FALSE, warning=FALSE}
print("Total de colaboradores medianos desligados:")
nrow(hr_func_medianos %>%   filter(left==1))

print("Total de bons colaboradores desligados:")
nrow(hr_func_bons %>%   filter(left==1))
```


```{r echo=FALSE}
# Calcula o total por faixa de satisfação no grupo dos "bons"
total_satisfacao <- cast(hr_func_bons, satisfied  ~ left, value = "salary")

# Altera o nome das colunas
colnames(total_satisfacao) <- c("Satisfacao", "Contratado", "Desligado")

# Imprime os resultados
formattable(total_satisfacao, 
            list(Desligado = color_tile("gray", "red")))
```

Once again we confirm that most of the good off-staffers were unsatisfied employees.

Increasing the context, we will compare the total per band for both who left and remain.

```{r}
table(hr$satisfied)
by(hr$left==1, hr$satisfied, summary)

```

As the range of satisfaction decreases, we perceive an increase in the total of who left and a decrease of the hired ones.

We have already explored and draw some conclusions about the relationship of the data set variables, now let's create a linear model having as the focal variable left.

```{r}
m1 <- lm(left ~ satisfaction_level, data = hr)
m2 <- update(m1, ~ . + time_spend_company)
m3 <- update(m2, ~ . + average_montly_hours)
m4 <- update(m3, ~ . + number_project)
mtable(m1, m2, m3, m4)
```

The variables satisfaction_level, time_spend_company, average_montly_hours, and number_project obtained the same r² of 0.2. 20% is a weak result and below my expectation.

At this point, I know that the level of satisfaction may be related to why the employee leaves, so I will create another model in which this variable is the focal point for the others.

```{r}
m1 <- lm(satisfaction_level ~ average_montly_hours, data = hr)
m2 <- update(m1, ~ . + time_spend_company)
m3 <- update(m3, ~ . + number_project)
m4 <- update(m4, ~ . + promotion_last_5years)
mtable(m1, m2, m3, m4)
```

20% of the satisfaction level can be explained by the numbers of projects and promotions in the last 5 years. This relationship does not imply causality.

To complement our analysis we will create a new model using the rpart method to construct a decision tree. At the end of the process we will have a good view of the data.

First we need to separate one sample of test data and one sample of training. I'm defining it to be 80% the size of the original. I will change the contents of left, 0 = Remain and 1 = Left.

```{r}
hr$left <- factor(hr$left, labels=c("Remain", "Left"))

# Cria amostra com 80% do tamanho de hr
sample_size <- floor(0.80 * nrow(hr))

# Set.seed para fins do resultado randomico
set.seed(123)

# Cria lista de índices
train_ind <- sample(seq_len(nrow(hr)), size = sample_size)

# Amostra para treino
train <- hr[train_ind, 1:8]

# Amostra para teste
test <- hr[-train_ind, 1:8 ]

```

The model will be based on the variables that have been investigated until now and that we consider important during the exploratory analysis. The factor to be predicted will be left, that is, whether the employee will remain or leave, and the model will be based on the level of satisfaction, note of the last evaluation, average monthly hours worked, number of projects and years worked in the company.

```{r}
# Cria o modelo
fit <- rpart(left ~ satisfaction_level + last_evaluation + 
                    average_montly_hours + number_project + 
                    time_spend_company,
             data=train,
             method="class")

# Prediz o resultado
predicted_hr <- predict(fit, test)


auc(as.numeric(test$left) - 1, predicted_hr[, 2])
```

Wow! The classifier had an excellent score of 0.97.

Now that we know we have a great model, let's plot the decision tree.

```{r}
rpart.plot(fit, extra = 104, 
                box.palette="GnBu", 
                branch.lty=3, 
                shadow.col="gray", 
                nn=TRUE)
```
    
In fact it is a good model, see how it mirrors and reinforces the previous analysis, the employee with low satisfaction level, many projects, or satisfied and working for many hours a month is more likely to leave.

# Multivariate analysis


### Discuss the relationships observed in this part of the research. What attributes strengthened the others in the observation of the variables of interest?

When the level of satisfaction of the whole group is analyzed, a very different distribution is evident between those who remain in the company and those who leave. The remaining employees have a satisfaction between regular and satisfied, with a small volume of employees dissatisfied. Among those who left, the group of dissatisfied is the largest, demonstrating the correlation observed between them, but it can not be said that dissatisfaction is the cause of a dismissal for example.

The monthly hours worked also played an important role in the group of who left, being common to find the information polarized in groups of many or few hours worked monthly.

### Surprising and/or interesting interactions were found among the attributes?

It was a surprise to find that working for fewer hours than the monthly average was a common factor of unsatisfaction among those who left.

### Have models been created using this dataset? Discuss the strengths and limitations of your model.

Yes, three models were created, two linear and one decision tree.

The first linear regression model had the objective to verify the relationship between left and the variables satisfaction_level, time_spend_company, average_montly_hours, number_project. The variables were selected based on the correlation value found between them. The result received was a bit disappointing because the adjusted r² itself can only explain 20% of the dependent variable left. Another value to be observed by the model is that there is a high significance among the variables demonstrated by the value of p = 0.

In the 2nd model the objective of the linear regression model was to relate the level of satisfaction with the other variables. If it is not satisfied, it can be related, without being the cause, to the employee's exit, so what could be related to his low satisfaction? In the model created with total years worked in the company and the average monthly hours worked has the lowest value of r 2 = 0, and the variables with the number of projects worked and the existence of promotion in the last years demonstrated a low correlation with the low Satisfaction of it being r² = 0.2.

As the two linear models succeeded, I broadened the analysis by creating the 3rd decision tree model to test the model's ability and data to predict which employees are more likely to leave the company. I particularly like decision tree because you can create templates in a quick, simple way and they are effective in communicating the result. I used rpart.plot to print the sequence of decisions taken and illustrate what we had already observed during the exploratory analysis.

------

# Final Charts and Summary
We started this project knowing a little about the company and its employees, we explored variables that indicated the existence of an accident at work, promotions, level of satisfaction, grade received in the last evaluation, number of projects, monthly average hours worked, salary and department . The focus, which has led us so far, was to find out the reasons why people left the company. Within this context, the left variable was the centerpiece.

In addition to displaying graphs with the distribution of the variables individually and the relationships between them, correlation values were calculated and 2 linear models and a decision tree were created.

To complete the exploration of the data will be displayed 3 graphs that summarize the observations found.

### First Chart

Para começar selecionei as variáveis average_montly_hours e satisfaction_level. A variável satisfaction_level, dentre todas do conjunto de dados, foi a que teve o valor de correlação mais significativo com left, sendo -0.38. Em outros gráficos, average_montly_hours trouxe informações relevantes, demonstrando sempre a existência de uma média mensal superior de horas trabalhadas para os desligados em comparação com os contratados.

Temos uma média de 198 horas mensais trabalhadas para os contratados e 224 horas para os desligados. As máximas registradas foram 287 e 310 horas respectivamente.


```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(hr, aes(x      = average_montly_hours, 
               y      = satisfaction_level, 
               colour = left)) + 
  geom_point(alpha = 1/5, 
             position = position_jitter(h=0)) + 
  labs(title = "Nível de satisfação por total de horas trabalhadas mensais",
       x     = "Total horas trabalhadas",
       y     = "Nível de satisfação") +
  scale_color_wsj()

``` 
  
We see here a summary of the observations made in this project, we conclude that the people who left the company were overburdened and unsatisfied. For those people we have:

1. The unsatisfied who worked less than the general average and those who worked more than the average and more than the remain;
2. Those with a good level of satisfaction, but who also had a monthly average of hours worked over 201 hours of the general average.

### Second chart

The second chart displays information based on the number of projects worked. This variable had an important performance during the bivariate analysis, because we perceived a different behavior of the data for those who left whenever the number of projects was added to the analysis. We shall reproduce these observations below.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(hr, aes(x    = as.factor(number_project), 
               y    = satisfaction_level, 
               fill = left)) + 
  geom_boxplot(outlier.colour = "black", 
               outlier.size   = 0.5) + 
  labs(title = "Nível de satisfação por total de projetos",
       x     = "Números de projetos trabalhados",
       y     = "Nível de satisfação") +
  scale_fill_wsj()

```
  
Well, this chart leads us to the following observations:

1. Those who left was overloaded with 6 and 7 projects registered very low levels of satisfaction;
2. We have low satisfaction level also among those who worked with 2 projects;
3. For who left, the highest satisfactions were found in those who worked on 4 or 5 projects.

### Third chart

In the last graph we have the data printed only for who left. In graph 1 we saw the level of satisfaction and working hours, in chart 2 we captured an overload of projects and now we will add the variable last_evaluation to have a broader view of the employee and the note given by the company in the last evaluation is important for understanding the context.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x=number_project, y=last_evaluation, col=satisfied),
       data = subset(hr, left=="Desligado")) +  	
  geom_point(alpha = 1/5, 
             position = position_jitter(h=0)) + 
  scale_x_continuous(breaks = seq(1,7,1)) +
  labs(title = "Nota na última avaliação por total de projetos dos desligados",
       x     = "Números de projetos trabalhados" ,
       y     = "Nota na última avaliação") +
  scale_color_wsj(name = "Nível de satisfação")
```
  
People with 2 projects experience a low or medium level of satisfaction as we have seen. Employees who worked on 4 or 5 projects received good grades in their assessments and demonstrated a good level of satisfaction. We also have those who worked on 6 and 7 projects, they received a good evaluation of the company, but they definitely were not satisfied.

Even if the company recognizes the employee's work through a good grade in his assessment, he is likely to leave the company if he is feeling overwhelmed and dissatisfied.

------

# Reflection

It is always very exciting to investigate a database looking for factors that can help an organization retain its talents and keep up with a top-notch team. The limitation of this analysis is that it is based on human behavior, and the few variables in the data set are not enough to deliver a consistent result that can be followed by the organization. It would be very productive for this analysis to know information about the positions, the level of satisfaction per year of work, the level of complexity of the projects worked and even the hiring regime.

With the available information it was possible to identify how much the work load is a determining factor for the employee's exit. Even if he has gotten a good grade in the assessment and is satisfied, if he is under an overburden of design and hours of work he will probably leave. But if he is already a little dissatisfied and the company assigns him many hours or less hours than the average worked by all, it is possible that he also quit.

I would like to have more information on the monetary value of the salary. Understanding whether pay can be a factor of unsatisfaction is difficult when you do not know the job and the actual salary. What can be perceived in relation to the recognition of the work is that very few promotions have been registered, even the proportion of work accidents is higher than that of promotions. Among those who left few people had a high salary.

While not having all the variables that I consider important, it was fun to investigate the issues proposed at the beginning of this project, I would say that creating a decision tree, and getting such a high AUC was one of the most rewarding points in the process.

In future work it would be interesting to use random forest as a predictor of results, its more complex decision algorithm would be a good comparison with the decision tree model used in this project.


