HR por Lieby Cardoso
========================================================

Employee satisfaction level
Last evaluation
Number of projects
Average monthly hours
Time spent at the company
Whether they have had a work accident
Whether they have had a promotion in the last 5 years
Department
Salary
Whether the employee has left

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Carregue aqui todos os pacotes utilizados 
# na sua anÃ¡lise realizada neste arquivo fonte.

# Note que o parÃ¢metro "echo" foi definido como FALSE neste cÃ³digo.
# Isso previne que o cÃ³digo apresente resultados formatados em HTML.
# VocÃª deve definir echo=FALSE para todos os blocos de cÃ³digo no seu arquivo.

library(ggplot2)

library(ggthemes) 

# Cria objetos gráficos e posiciona em uma página
library(gridExtra)

# Facilita a limpeza dos dados spread() & gather()
library(tidyr)

# Manipulação de dados
library(dplyr)

# Templates adicionais do ggplot2
library(GGally)
library(plyr)

#library(maptools)

library(corrplot)

library(formattable)

library(RColorBrewer)
library(memisc)
library(lattice)
library(MASS)
library(car)
library(reshape)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
#library(scales)


```

```{r}

```

```{r echo=FALSE, Load_the_Data}
# Carregamento dos dados

hr <- read.csv('P:/Nanodegree/P04_Explore_Summarize/Explore_Summarize_R/HR_data.csv', sep = ',', na.strings=c("","NA"))
names(hr)

```


```{r}
str(hr)
```
```{r}

```

```{r}
```

```{r}
# Verifica o total de valores nulos no campo de percentual de financiamento concedido que é o mais foco principal

```
```{r}
summary(hr)

```
```{r}
fies$IDADE = as.numeric(round(difftime(Sys.Date(), fies$DT_NASCIMENTO)/365))
```

```{r}
# Verifica o total de NA em cada campo
for (i in 1:9) {
  print (paste(names(hr[i]) , sum(is.na(hr[i])), sep="="))
  next
  
}
```


```{r echo=FALSE, Univariate_Plots}
# Exclui os regitros com NA
hr <- hr[complete.cases(hr),]
```



```{r}
```
```{r}
table(hr$salary)
table(hr$sales)
```
```{r}
levels(hr$salary)
levels(hr$sales)
```
 

```{r}
hr$salary_le = c("high"=0, "low"=1, "medium"=2)[as.numeric(hr$salary)]
hr$sales_le = c("accounting"=0, "hr"=1, "IT"=2, "management"=3,  "marketing"=4,  "product_mng"=5, "RandD"=6, "sales"=7, "support"=8, "technical"=9)[as.numeric(hr$sales)]
```

```{r}
table(hr$salary_le)
table(hr$sales_le)
```
```{r}
hr_ggpairs = hr[,c(1,2,3,4,5,6,7,8,11,12)]
g <- ggpairs(hr_ggpairs )
```


```{r}
# Imprime a matriz com todos os gráficos
svg("ggpairs_hr.svg")
print(g)
dev.off()
```
```{r}

```

```{r}

```

```{r}
ggplot(aes(x = age, y = friend_count), 
              data = subset(pf, !is.na(year_joined.bucket))) + 
  geom_line(aes(color = year_joined.bucket), stat = "summary", fun.y = mean) +
geom_line(stat = "summary", fun.y = mean, linetype = 2)
```



```{r echo=FALSE, message=FALSE, warning=FALSE, packages}

```

```{r}
cor(hr[,1:8])
```



```{r}
corrplot(cor(hr[,1:8]), method="circle")
```
```{r}

```
```{r}
#hr_good_leaving_people <- hr_leaving_people %>% filter(last_evaluation >= 0.70 | time_spend_company >= 4 | number_project > 5)
#nrow(hr_good_leaving_people)

```

```{r}
summary(hr$promotion_last_5years)
```

```{r}

```
```{r}

```


```{r}

```

```{r}

```

```{r}

```

```{r}

```
```{r}

```

```{r}

```

```{r}

```
```{r}

```

```{r}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}
```


## Como é a empresa?
```{r echo=FALSE, message=FALSE, warning=FALSE}

grafico1 <- ggplot(aes(average_montly_hours),  data = hr) + 
  geom_histogram(fill="orange") +
  #scale_x_continuous(limits = c(4, 12), breaks = seq(4,12,1)) +
  #scale_x_log10() +
  #geom_density(col=2) + 
  labs(title="Hora média mensal trabalhada", 
       y="Total", 
       x= "Hora mensal trabalhada")

grafico2 <- ggplot(aes(time_spend_company), data = hr) + 
  geom_histogram(fill="orange") +
                 #aes(y =..density..)) +
  
  scale_x_continuous(limits = c(0, 11), breaks = seq(0,11,1)) +
  labs(title="Anos trabalhados na empresa", 
       y="Total", 
       x= "Anos de trabalho")

grafico3 <- ggplot(aes(Work_accident),  data = hr) + 
  geom_bar(fill = I("orange"))+
  scale_x_continuous(limits = c(-.5, 1.1), breaks = seq(0,1,1)) +
  labs(title="Total de acidentes de trabalho", 
         y="Total", 
         x= "Acidentes")

grid.arrange(grafico1, grafico2, grafico3, nrow=3)
```

### Perfil dos funcionarios
 "satisfaction_level"    "last_evaluation"       "number_project"        "average_montly_hours"  "time_spend_company"    "Work_accident"        
 [7] "left"                  "promotion_last_5years" "sales"                 "salary" 
```{r}
grafico1 <- ggplot(aes(satisfaction_level),  data = hr) + 
  geom_bar(fill="blue") +
  facet_wrap( ~ left) +
  #scale_x_continuous(limits = c(4, 12), breaks = seq(4,12,1)) +
  labs(title="Homens/Mulheres", 
       y="Total", 
       x= "Semestre Financiado")

grafico2 <- ggplot(aes(DS_ESTADO_CIVIL), data = fies, colours=DS_SEXO) + 
  geom_bar(fill="blue") +
  #geom_density(col=2) + 
  labs(title="Estado civil", 
       y="Total", 
       x= "Valor mensalidade - log10")

grafico3 <- ggplot(aes(fies$ST_ENSINO_MEDIO_ESCOLA_PUBLICA),  data = fies) + 
  geom_bar(fill = I("blue"))+
  #scale_x_continuous(limits = c(40, 110), breaks = seq(40,110,10)) +
  labs(title="Vindo de escola pública?", 
         y="Total", 
         x= "S: Sim, N: Não, P: Parcial")

grafico4 <- ggplot(aes(IDADE),  data = fies) + 
  geom_histogram(fill="blue",
           aes(y =..density..)) +
  scale_x_continuous(limits = c(15, 60), breaks = seq(15,60,5)) +
  geom_density(col=2) + 
  labs(title="Distribuição semestre financiado", 
       y="Total", 
       x= "Semestre Financiado")

grid.arrange(grafico1, grafico2, grafico3, grafico4, ncol=2, nrow=2,  heights=1:2, widths=1:2)

```
```{r}
ggplot(aes(satisfaction_level),  data = hr) + 
  geom_bar(fill="blue") +
  facet_wrap( ~ left) +
  #scale_x_continuous(limits = c(4, 12), breaks = seq(4,12,1)) +
  labs(title="Satisfação por status 0=Contratado, 1=Desligado", 
       y="Total", 
       x= "Nível de satisfação")
```

```{r}
ggplot(aes(promotion_last_5years),  data = hr) + 
  geom_bar(fill="blue") +
  facet_wrap( ~ left) +
  #scale_x_continuous(limits = c(4, 12), breaks = seq(4,12,1)) +
  labs(title="Promoção nos ultimos 5 anos (0=Contratado, 1=Desligado)", 
       y="Total", 
       x= "Promoções") +
  scale_colour_brewer(palette="Set1")
```
```{r}
ggplot(aes(x=sales, fill=salary), 
       data = hr) + 
  geom_histogram(stat = 'count') +
  facet_wrap( ~ left) 
```


```{r}
ggplot(aes(x=sales , fill=salary ),
       data = hr) + geom_bar()
```


```{r}
ggplot(aes(x=sales , fill=satisfaction_level ),
       data = hr) + geom_bar()
```

```{r}
table(hr$left)
by(hr$satisfaction_level, hr$left, summary)

```

```{r}
hr %>% 
  count(left) %>% 
  formattable(align = 'l')
```

# SÃ§Ã£o de GrÃ¡ficos Univariados


# AnÃ¡lise Univariada

### Qual Ã© a estrutura do conjunto de dados?
A estrutura de dados é composta por 14.999 observações, 10 variáveis importadas com o arquivo original, mais duas várias criadas para contabilização.

A variável left representa os colaboradores que ainda estão na empresa com o valor 0 e 1 para colaboradores desligados.

A maioria das variáveis são númericas e duas são categóricas representadas por fatores: sales com 10 níveis e salary com 3.

### Quais sÃ£o os principais atributos de interesse deste conjunto de dados?
A principal variável de interesse do conjunto é left, que informa se o colaborador está na empresa ou se foi desligado. A variável com o nível de satisfação (satisfaction_level) também será foco da análise, uma vez que, a correlação das outras variáveis com ela podem ajudar a compreender a os motivos que levaram as pessoas a deixarem a empresa.

### Quais outros atributos vocÃª acha que podem lhe auxiliar na investigaÃ§Ã£o destes atributos de interesse?
promotion_last_5years: O total de promoções recebidas (promotion_last_5years) pode gerar uma insatisfação no colaborador se ele supor que não foi reconhecido;
time_spend_company: O tempo passado numa empresa pode gerar uma necessidade de sair da empresa, nem sempre por uma causa negativa, mas pela vontade de viver novos desafios; 
salary: Essa variável é categorica com os valores baixo, médio e alto. A relação da remuneração com o satisfação e a decisão de saída será avaliado, apesar de várias pesquisas indicarem que o salario nem sempre é um grande influenciador nesta decisão. É possível que variáveis como número de promoções e nota recebida na ultima avaliação pesem mais na sensação de ter o trabalho reconhecido e este é um fator importante.
number_project: Essa variável não diz muita coisa, mas podemos supor que pessoas com mais números de projetos eram mais engajadas?
sales: Será que tem um departamento problemático?  

### VocÃª criou novas variÃ¡veis a partir dos atributos existentes no conjunto de dados?
O conjunto de dados estava bem consistente, as alterações realizadas foram para adaptar as informações para análise. Salary e Sales são do tipo factor, para elas criei duas novas variaveis, Salary_le e Sales_le para representa-las numericamente. É uma especíe de versão LabelEncoder de cada uma delas.

Pesquisei variaveis NA, mas o grupo não tinha nenhuma. Variáveis sem conteúdo não foram pesquisadas porque na importação do arquivo eu atribui por padrão o valor NA para elas (na.strings=c("","NA")), então, automaticamente ao pesquisar por NA, eu já estava pesquisando pelas vazias.

### Dos atributos investigados, distribuiÃ§Ãµes incomuns foram encontradas? VocÃª aplicou operaÃ§Ãµes nos dados para limpÃ¡-los, ajustÃ¡-los ou mudar a forma dos dados? Se sim, por quÃª?



# SeÃ§Ã£o de GrÃ¡ficos Bivariados
```{r echo=FALSE, Bivariate_Plots}

```

# AnÃ¡lise Bivariada

```{r}
with(hr, cor.test(salary_le, satisfaction_level, method = 'pearson'))
```


### Discuta sobre alguns dos relacionamentos observados nesta parte da investigaÃ§Ã£o. Como os atributos de interesse variaram no conjunto de dados?

### VocÃª observou algum relacionamento interessante entre os outros atributos (os que nÃ£o sÃ£o de interesse)?

### Qual foi o relacionamento mais forte encontrado?




# SeÃ§Ã£o de GrÃ¡ficos Multivariados

```{r echo=FALSE, Multivariate_Plots}

```

# AnÃ¡lise Multivariada

### Discuta sobre os relacionamentos observados nesta parte da investigaÃ§Ã£o. Quais atributos que fortaleceram os demais na observaÃ§Ã£o das variÃ¡veis de interesse?

### InteraÃ§Ãµes surpreendentes e/ou interessantes foram encontradas entre os atributos?

### OPCIONAL: Modelos foram criados usando este conjunto de dados? Discuta sobre os pontos fortes e as limitaÃ§Ãµes do seu modelo.

------

# GrÃ¡ficos Finais e SumÃ¡rio

### Primeiro GrÃ¡fico
```{r echo=FALSE, Plot_One}

```

### DescriÃ§Ã£o do Primeiro GrÃ¡fico


### Segundo GrÃ¡fico
```{r echo=FALSE, Plot_Two}

```

### DescriÃ§Ã£o do Segundo GrÃ¡fico


### Terceiro GrÃ¡fico
```{r echo=FALSE, Plot_Three}

```

### DescriÃ§Ã£o do Terceiro GrÃ¡fico

------

# ReflexÃ£o
http://stackoverflow.com/questions/1260965/developing-geographic-thematic-maps-with-r

